-- Створюємо таблиці
CREATE TABLE IF NOT EXISTS spells (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  level TINYINT NOT NULL,
  actions TINYINT NOT NULL,
  spell_range INT NOT NULL,
  concentration BOOLEAN NOT NULL DEFAULT FALSE,
  ritual BOOLEAN NOT NULL DEFAULT FALSE,
  duration_value INT DEFAULT NULL,
  duration_unit VARCHAR(50) DEFAULT 'moment',
  duration_custom_unit VARCHAR(100) DEFAULT NULL,
  narrative_description TEXT,
  mechanical_description TEXT,
  has_higher_levels BOOLEAN NOT NULL DEFAULT FALSE,
  components JSON,
  higher_levels JSON
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS traditions (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL UNIQUE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS spell_traditions (
  spell_id INT NOT NULL,
  tradition_id INT NOT NULL,
  PRIMARY KEY (spell_id, tradition_id),
  FOREIGN KEY (spell_id) REFERENCES spells(id) ON DELETE CASCADE,
  FOREIGN KEY (tradition_id) REFERENCES traditions(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Наповнюємо даними
INSERT INTO traditions (name) VALUES
('Медус'), ('Стихії'), ('Фераїс'), ('Лореліс'), ('Аворелія'),
('Некромантія'), ('Сільферус'), ('Пентеони'), ('Обскурус'),
('Астрамантія'), ('Санґатус'), ('Геометрія'), ('Алхімія')
ON DUPLICATE KEY UPDATE name=name;

INSERT INTO spells (
  id, name, level, actions, spell_range, concentration, ritual,
  duration_value, duration_unit, duration_custom_unit,
  narrative_description, mechanical_description,
  has_higher_levels, components, higher_levels
) VALUES
(
  1, 'Пісочний клинок', 2, 1, 0, 0, 1,
  0, 'until_short_rest', '',
  'Ти осипаєш лезо жменею піску, промовляючи слова заклинання. Тепер кожен помах твого клинка наче сам спрямовує тебе до цілі.',
  'Після першого попадання клинком по противнику ти отримуєш +1к4 на всі влучання по ньому. Поза боєм ти можеш поставити клинок на рівну поверхню і якщо противник знаходитиметься на відстані до 100 метрів то лезо вкаже на нього.',
  1,
  '["Холодна зброя","Грудка піску"]',
  '{"5": {"narrative": "Кожен рух розсіює пісок в повіті створюючи невидимий з’вязок між лезом та раною противника.", "mechanical": "Ціль на початку кожного раунду отримує додаткові 1к4 шкоди, якщо знаходиться в межах 100 метрів від клинка"}}'
),
(
  2, 'Четвірка (Маревний крок)', 0, 1, 20, 0, 1,
  0, 'moment', '',
  'Персонаж жбурляє гральну карту та телепортується на місце її приземлення/зіткнення ',
  'Телепортація на 20м, теоречний урон як від жбурляння карти',
  0,
  '["Зачарована гральна карта"]',
  '{}'
),
(
  3, 'Арканічні прояви', 0, 1, 5, 0, 0,
  1, 'minutes', '',
  'Незначне втручання у плетіння аркани, що має мінімальні прояви у світі. Наприклад посилення власного голосу, мерехтіння полум’я свічки, стишення грому чи випрямлення листа паперу.',
  'З вищими рівнями можна створювати більше таких проявів одночасно, давати їм більший ефект та тривалість. (На розсуд майстра)',
  0,
  '[]',
  '{}'
),
(
  4, 'Згусток енергії', 0, 1, 15, 0, 0,
  0, 'moment', '',
  'Утворення невеликого згустку арканічної енергії у руках. ',
  'Цей згусток можна запустити у ціль, подолавши по прямій траєкторії 15 метрів він розсіється. При потраплянні заряду в істоту наносить 1к4+1 ушкоджень.',
  1,
  '[]',
  '{"1": {"narrative": "", "mechanical": "20 метрів, 2к4+2"}, "2": {"narrative": "", "mechanical": "25 метрів, 2к6+3"}, "3": {"narrative": "", "mechanical": "30 метрів, 3к6+4"}, "4": {"narrative": "", "mechanical": "35 метрів, 3к8+5"}, "5": {"narrative": "", "mechanical": "40 метрів, 4к8+6"}, "6": {"narrative": "", "mechanical": "45 метрів, 4к10+7"}, "7": {"narrative": "", "mechanical": "50 метрів, 5к10+8"}, "8": {"narrative": "", "mechanical": "55 метрів, 5к12+9"}, "9": {"narrative": "", "mechanical": "60 метрів, 6к12+10"}}'
),
(
  5, 'Ілюзорне викривлення', 0, 1, 5, 0, 0,
  1, 'minutes', '',
  'Мала ілюзія, що створює невеликий візуальний образ предмета. Він не може рухатись чи змінюватись і тактильно не відчутний.',
  'На вищих рівнях можливо збільшити предмет та їх кількість, тривалість заклинання, дати йому 1 додаткову властивість як от запах, смак, звук чи тактильні відчуття та рухмість. (Балансування відбувається на розсуд майстра)',
  0,
  '[]',
  '{}'
),
(
  6, 'Танцююче світло', 0, 1, 20, 0, 0,
  10, 'seconds', '',
  'Створення декількох вогників, що левітують у повітрі і випромінюють тьмяне світло. Їх можна з’єднати у єдине  джерело світла схоже на свічку.',
  'Вогники випромінюють світло на 2 метри від себе. Єдине сформоване джерело називається маяк.',
  1,
  '[]',
  '{"1": {"narrative": "Кількість вогників більшає, а маяк тепер вимпромінює світло майже як ліхтар.", "mechanical": "Відстань від себе: 25м\\nКількість вогників: 3\\nСвітіння маяка: 5м\\nТривалість: 1 хвилина"}, "2": {"narrative": "Кількість вогників більшає, а маяк починає випромінювати тепло і його світіння може зрівнятись із розведеним багаттям.", "mechanical": "Відстань від себе: 25м\\nКількість вогників: 3\\nСвітіння маяка: 5м\\nТривалість: 1 хвилина"}, "3": {"narrative": "Кількість вогників більшає, а маяк тепер зігріває і світиться наче велика ватра.", "mechanical": "Відстань від себе: 30м\\nКількість вогників: 5\\nсвітіння маяка: 5м\\nтривалість: 1 хвилина"}, "4": {"narrative": "Дюжина вогників, які даруватимуть світло наче при сутінках чи пасмурній погоді.", "mechanical": "Відстань від себе: 25м\\nКількість вогників: 3\\nСвітіння маяка: 5м\\nТривалість: 1 хвилина"}, "5": {"narrative": "21 вогник тепер освітлюватиме темну місцину навколо так наче то день. А нечисть почне ховатися від таког освітіння.", "mechanical": "Відстань від себе: 25м\\nКількість вогників: 3\\nСвітіння маяка: 5м\\nТривалість: 1 хвилина\\nНежить на яку світло потрапляє отримує 1к4+1 променевої шкоди щораунду"}, "6": {"narrative": "Кілька десятків вогників зливаючись у танці вимпромінюють яскраве сонячне світло більш ніж на сотню метрів. Нежить боятиметься його наче сонця в зеніті.", "mechanical": "Відстань від себе: 25м\\nКількість вогників: 3\\nСвітіння маяка: 5м\\nТривалість: 1 хвилина\\nНежить на яку світло потрапляє отримує 2к4+2 променевої шкоди щораунду"}, "7": {"narrative": "Світло моментами є уже настільки яскравим що осліплює навіть тих хто звик до нього.", "mechanical": "Відстань від себе: 25м\\nКількість вогників: 3\\nСвітіння маяка: 5м\\nТривалість: 1 хвилина\\nУсі під світлом отримують 1к4-2 променевої шкоди щораунду\\nНежить на яку світло потрапляє отримує 2к6+2 променевої шкоди щораунду"}, "8": {"narrative": "Велика розжарена куля світла, що повілно перетворює ліси й луги на пустелі.", "mechanical": "Відстань від себе: 25м\\nКількість вогників: 3\\nСвітіння маяка: 5м\\nТривалість: 1 хвилина\\nУсі під світлом отримують 2к6-4 променевої шкоди щораунду\\nНежить на яку світло потрапляє отримує 3к8+3 променевої шкоди щораунду"}, "9": {"narrative": "Більше сотні вогників, що зібравшись разом випалюють все що надто довго затримується під їх променями .", "mechanical": "Відстань від себе: 25м\\nКількість вогників: 3\\nСвітіння маяка: 5м\\nТривалість: 1 хвилина\\nУсі під світлом отримують 3к8-6 променевої шкоди щораунду\\nНежить на яку світло потрапляє отримує 3к10+3 променевої шкоди щораунду"}}'
),
(
  7, 'Дотик стійкості', 0, 1, 0, 0, 0,
  1, 'minutes', '',
  'Дотик до істоти, що дарує їй стійкість у її намаганні встояти перед будь-яким впливом, чи то фізичним чи то моральним.',
  'Істота отримує +1к4 до наступного рятівного кидка.',
  1,
  '[]',
  '{"1": {"narrative": "", "mechanical": "1 істота, 10 хвилин, 1к4"}, "2": {"narrative": "", "mechanical": "2 істоти, 1 година, 1к4"}, "3": {"narrative": "", "mechanical": "2 істоти, 1 година, 1к6"}, "4": {"narrative": "", "mechanical": "3 істоти, 8 годин, 1к6"}, "5": {"narrative": "", "mechanical": "3 істоти, 8 годин, 1к8"}, "6": {"narrative": "", "mechanical": "4 істоти, ~1 день, 1к8"}, "7": {"narrative": "", "mechanical": "4 істоти, ~1 день, 1к10"}, "8": {"narrative": "", "mechanical": "5 істот, до використання, 1к10"}, "9": {"narrative": "", "mechanical": "5 істоти, до використання, 1к12"}}'
),
(
  8, 'Примарна кінцівка', 0, 2, 5, 0, 1,
  5, 'minutes', '',
  'Візьміть рукавицю або чепревик. Одягніть на руку чи ногу відповідно. Беріть речі до рук. ходіть, використовуйте свою кінцівку і впродовж кількох хвилин промовляйте слова заклинання. після цього ви матимете примарну кінцівку, яка хоч і напівпрозора, але цілком матеріальна і може допомагати вам.',
  'Кінцівка повністю повторює рухи вашої кінцівки і не може рухатись сама чи за вашим бажанням. Рукою можна підняти лише половину від того що ви можете підняти однією рукою самі. Ногою можна штовхнути лише в половину сили вашог овласного поштовху.',
  1,
  '["Рукавиця або червик"]',
  '{"1": {"narrative": "Тепер не потрібно самостійно рухати руками чи ногами аби заставити примарну кінцівку рухатись. Просто направте її, чітко уявіть що вона має робити.", "mechanical": "Кінцівка тепер керована вашими думками і може діяти у повну силу, якою володієте ви. "}, "2": {"narrative": "Примарна кінцівка відтепер може самостійно діяти, виконуючи вашу волю.", "mechanical": "Подумайте про те чого бажаєте і кінцівка сама "}}'
),
(
  9, 'Рубіновий захист', 3, 2, 0, 0, 0,
  2, 'minutes', '',
  'Р',
  'Р',
  0,
  '[]',
  '{}'
);

INSERT INTO spell_traditions (spell_id, tradition_id) VALUES
(1, (SELECT id FROM traditions WHERE name = 'Стихії')),
(2, (SELECT id FROM traditions WHERE name = 'Медус')),
(3, (SELECT id FROM traditions WHERE name = 'Медус')),
(4, (SELECT id FROM traditions WHERE name = 'Медус')),
(5, (SELECT id FROM traditions WHERE name = 'Обскурус')),
(5, (SELECT id FROM traditions WHERE name = 'Медус')),
(6, (SELECT id FROM traditions WHERE name = 'Медус')),
(6, (SELECT id FROM traditions WHERE name = 'Обскурус')),
(8, (SELECT id FROM traditions WHERE name = 'Медус')),
(9, (SELECT id FROM traditions WHERE name = 'Лореліс')),
(9, (SELECT id FROM traditions WHERE name = 'Медус'));

ALTER TABLE spells AUTO_INCREMENT = 10;